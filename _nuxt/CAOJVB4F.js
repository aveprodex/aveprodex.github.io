import{f as e,h as a,at as s,aK as t,a8 as l,aL as i,z as n,av as o,B as r,co as u,ay as d,cd as c,aY as m,aW as p,a9 as v,i as f,q as b,ax as h,x as _,kY as g,aM as x,G as k,H as y,j as w,c as N,o as A,a as F,b as S,I as j,D as $,w as T,d as C,t as I,E,T as R,F as z,r as U,e as V,aI as L,J as M,aH as P,n as B,cq as W,W as H,K as O,ae as D,c1 as K,az as q,aO as G,aP as Q,aQ as Y,aR as J,aT as X,aU as Z,aV as ee}from"./C1fvdsSF.js";import{_ as ae}from"./C6y_T8EP.js";import{E as se}from"./BpYdBJN9.js";import{u as te,_ as le}from"./Mm6ESix1.js";import{u as ie}from"./D_UEnzia.js";import"./BfEthlv8.js";import"./X6ThVr0t.js";import"./Cg-3-cPy.js";import"./CsYTjuNL.js";import"./CM-2Ienw.js";import"./Dy-u-xy9.js";import"./B-tTJccZ.js";import"./DLELZeV_.js";import"./fqR6pdbk.js";import"./rP0JeNkw.js";const ne={class:"flex justify-between items-center mt-10px pr-15px"},oe=["infinite-scroll-disabled"],re={class:"pr-10px pb-20px"},ue={class:"flex-[1.5] flex items-center"},de={class:"ml-6px"},ce={class:"flex"},me={class:"color-[var(--d-F5F5F5-l-333)]"},pe={class:"mt-2px color-[var(--d-999-l-666)]"},ve={class:"flex-1 flex flex-col items-end"},fe={class:"flex-1 flex justify-end"},be={key:1,class:"color-[var(--d-EAECEF-l-333)]"},he={key:0,class:"color-#959a9f text-12px text-center"},_e=e({__name:"positionsTable",props:{height:{type:[Number,String],default:370}},setup(e){const{t:_e}=a(),ge=s(),xe=t(),ke=l(),ye=ie(),we=te(),Ne=i();n((()=>ge.wsResult[d.PRICEV2]),(e=>{const a={};e.prices.forEach((e=>{a[e.token+"-"+e.chain]=e})),Pe.value=Pe.value.map((e=>{const s=a[e.index];if(s&&s.uprice>0){const a="--"===e.total_profit||0===Number(e.total_profit),t=new r(e.balance||0).times(s.uprice||0);if(a)return{...e,current_price_usd:s.uprice,balance_usd:t.toNumber()};{const a=new r(e.balance_usd||0).minus(e.total_profit||0),l=t.minus(a),i=new r(s.uprice||0).minus(e.average_purchase_price_usd||0).div(e.average_purchase_price_usd);return i.toNumber()<-1||Number(e.average_purchase_price_usd)<0?e:{...e,current_price_usd:s.uprice,balance_usd:t.toNumber(),total_profit:l.toFixed(),total_profit_ratio:i.toFixed()}}}return e})),u(Pe)})),n((()=>ge.wsResult[d.ASSET]),(e=>{var a;if(e.swap){const a="So11111111111111111111111111111111111111112"===e.swap.token||e.swap.token===c?c:e.swap.token,s=e.swap.chain,t=e.swap.type;if(a&&s){const l=Pe.value.findIndex((e=>e.token===a&&e.chain===s)),i="0"===t,n="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"===a,o=Pe.value[l].balance;l>-1&&(i?n?Ae(a,s):(Pe.value[l].balance=Number(o)+Number(e.swap.amount),u(Pe)):n?Ae(a,s):Number(o)===Number(e.swap.amount)?(Pe.value.splice(l,1),u(Pe)):(Pe.value[l].balance=Number(o)-Number(e.swap.amount),u(Pe)))}}else if(e.transfer){const s=e.transfer.chain,t=e.transfer.token,l=e.transfer.type;if(t&&s){const i=Pe.value.findIndex((e=>e.token===t&&e.chain===s)),n="0"===l;if(i>-1){const s=Pe.value[i],t=Number(s.balance),l=s.current_price_usd,o=new r(t).plus(n?e.transfer.amount:-(null==(a=e.transfer)?void 0:a.amount)),d=o.multipliedBy(l);s.balance=o.toString(),s.balance_usd=d.toNumber(),u(Pe)}}}}));const Ae=m((function(e,a){const s=ke.getWalletAddress(a);s&&p({chain:a,walletAddress:s,tokens:[e]}).then((s=>{Pe.value=Pe.value.map((t=>t.token===e&&t.chain===a?{...t,balance:s[0].balance,balance_usd:new r(s[0].balance||0).times(t.current_price_usd||0).toNumber()}:{...t}))}))}),1e3,!1,!0);function Fe(){Me.value.pageNo=1,Me.value.finished=!1}const Se=v(),je=f((()=>ke.userInfo?ke.userInfo.addresses.map((({address:e,chain:a})=>e+"-"+a)):Se.address?[Se.address+"-"+Se.chain]:[]));n((()=>je.value),(()=>{$e.value.user_ids=je.value}));const $e=b({hide_risk:1,hide_small:0,user_ids:je.value}),Te=b({}),Ce=e,Ie=f((()=>Number(Ce.height)-110)),Ee=h("scrollContainerRef"),Re=q((()=>{const{value:e}=Ee;e&&e.scrollHeight<=e.clientHeight&&!Me.value.finished&&Be()}),200);n(Ie,Re);const ze=o({sortBy:void 0,activeSort:0}),Ue={"-1":"asc",1:"desc"},Ve=f((()=>({sort_dir:Ue[ze.value.activeSort],sort:ze.value.sortBy}))),Le=f((()=>[{label:`${_e("token")}/${_e("balance1")}`,value:"balance_usd",flex:"flex-[1.5]",sort:!0},{label:_e("profit2"),value:"total_profit",flex:"flex-1 justify-end",sort:!0},{label:"",value:"",flex:"flex-1 justify-end",sort:!1}])),Me=o({finished:!1,loading:!1,pageNo:1,pageSize:10}),Pe=o([]);async function Be(){try{Me.value.loading=!0;const e=Me.value.pageNo,a=await g({pageNO:Me.value.pageNo,pageSize:Me.value.pageSize,...$e.value,...Ve.value});if(Array.isArray(null==a?void 0:a.data)&&a.data.length>0){if(1===e)Pe.value=a.data.map((e=>{var a;return{...e,index:e.token===c?(null==(a=x(e.chain))?void 0:a.wmain_wrapper)+"-"+e.chain:`${e.token}-${e.chain}`}}));else{const e=a.data.filter((e=>Pe.value.every((a=>a.index!==`${e.token}-${e.chain}`)))).map((e=>{var a;return{...e,index:e.token===c?(null==(a=x(e.chain))?void 0:a.wmain_wrapper)+"-"+e.chain:`${e.token}-${e.chain}`}}));Pe.value=Pe.value.concat(e)}Me.value.finished=a.data.length<Me.value.pageSize,Me.value.finished||Me.value.pageNo++}else 1===Me.value.pageNo&&(Pe.value=[]);we.setMultiPriceParams("positions",Pe.value.map((e=>e.token+"-"+e.chain))),we.sendPriceWs()}catch(e){}finally{Me.value.loading=!1,u(Me)}}async function We(e){if(!G())return;if(!e.token)return;const a=ke.getWalletAddress(e.chain);if(a)try{Te.value[e.index]=!0;const s=(await p({chain:e.chain,tokens:[e.token],walletAddress:a}))[0];s&&(e.balance=s.balance||0,e.balance_usd=new r(s.balance||0).times(e.current_price_usd||0).toNumber(),e.decimals=s.decimals||e.decimals);const t=s.balance||0;if(!t)return void Q({title:"Error",type:"error",message:s("insufficientBalance")});await ye.checkApproveAndApprove({chain:e.chain,token:e.token,owner:a}),function(e,a){var s;if(!G())return;if(new r(e||0).lte(0))return void Q({title:"Error",type:"error",message:_e("amountMustG0")});const t=null==(s=new r(e||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${a.decimals||18}})?`)))?void 0:s[0];if((Number(t)||0)<=0)return void Q({title:"Error",type:"error",message:_e("amountTooSmall")});Te.value[a.index]=!0,async function(e,a){var s,t,l;const i="solana"===a.chain,{botSettings:o}=xe,u=null==(s=null==o?void 0:o[a.chain])?void 0:s.selected,d=null==(t=null==o?void 0:o[a.chain])?void 0:t[u];if(i&&(null==d?void 0:d.mev)&&!(await ke.getBundleAvailable()))return void(Te.value[a.index]=!1);const{gasTip1List:m,gasTip2List:p}=Y(J().gasTip,"solana"),v=(null==d?void 0:d.mev)?m:p,f=(null==d?void 0:d.mev)?null==d?void 0:d.gas[0]:null==(l=null==d?void 0:d.gas)?void 0:l[1];let b={};if(i){let e=(null==f?void 0:f.customFee)||(null==v?void 0:v[null==f?void 0:f.level])||"0.002";(null==d?void 0:d.mev)&&new r(e).lt("0.002")&&(e="0.002"),b.priorityFee=new r(e).times(10**9).toFixed(0)}else{const e=0===Number(null==f?void 0:f.customFee)?"0":(null==f?void 0:f.customFee)||(null==v?void 0:v[null==f?void 0:f.level])||"3";b.gasTip=Number(new r(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=a.chain}const h={solana:"sol",ton:"TON"}[a.chain]||c,_=(null==d?void 0:d.slippage)||"9",g=ke.getWalletAddress(a.chain);if(!g)return;b={...b,batchId:Date.now().toString(),swapList:[{creatorAddress:g,inAmount:new r(e||0).times(10**a.decimals||0).toFixed(0)}],inTokenAddress:a.token,outTokenAddress:h,swapType:2,isPrivate:(null==d?void 0:d.mev)||!1,slippage:"auto"!==_?Number(new r(_).times(100).toFixed(0)):900};(i?X(b):Z(b)).then((e=>function(e,a,s){if(e){let e=setTimeout((()=>{Q({type:"success",message:_e("transactionsSubmitted")}),Ne.placeOrderUpdate++,Te.value[s]=!1}),500);const t=n((()=>ge.wsResult.tgbot),(l=>{var i,n,o,r;l.batchId===a&&(e&&(clearTimeout(e),e=null),Ne.placeOrderSuccess++,(null==(n=null==(i=null==l?void 0:l.txList)?void 0:i[0])?void 0:n.success)?(Q({type:"success",message:_e("tradeSuccess")}),t()):(ee((null==(r=null==(o=null==l?void 0:l.txList)?void 0:o[0])?void 0:r.failMessage)||"swap error"),t()),Te.value[s]=!1)}))}}(e,b.batchId,a.index))).catch((e=>{ee(e||"swap error"),Te.value[a.index]=!1}))}(e,a)}(t,e)}finally{Te.value[e.index]=!1}}return _((()=>{Be()})),n((()=>[Ve.value,$e.value.hide_risk,$e.value.hide_small,ke.evmAddress,()=>Se.address,()=>Se.walletSignature[Se.address]]),(()=>{Fe(),Be()})),(e,a)=>{const s=E,t=ae,l=L,i=M,n=H,o=V,r=D,u=se,d=K,c=y;return k((A(),N("div",null,[F("div",ne,[S(s,{modelValue:w($e).hide_risk,"onUpdate:modelValue":a[0]||(a[0]=e=>w($e).hide_risk=e),class:"ml-12px",style:{marginRight:0},size:"small","true-value":1,"false-value":0},{default:T((()=>[C(I(e.$t("hideRiskTokenShort")),1)])),_:1},8,["modelValue"]),S(s,{modelValue:w($e).hide_small,"onUpdate:modelValue":a[1]||(a[1]=e=>w($e).hide_small=e),size:"small","true-value":1,"false-value":0},{default:T((()=>[C(I(e.$t("hideSmallAssets1")+"<1USD"),1)])),_:1},8,["modelValue"]),w(ke).evmAddress?(A(),j(t,{key:0,userIds:w($e).user_ids,"onUpdate:userIds":[a[2]||(a[2]=e=>w($e).user_ids=e),a[3]||(a[3]=e=>{Fe(),Be()})]},null,8,["userIds"])):$("",!0)]),S(le,{sort:w(ze),"onUpdate:sort":a[4]||(a[4]=e=>R(ze)?ze.value=e:null),columns:w(Le)},null,8,["sort","columns"]),S(u,{height:w(Ie)},{default:T((()=>[k((A(),N("div",{ref_key:"scrollContainerRef",ref:Ee,"infinite-scroll-disabled":w(Me).finished||w(Me).loading,"infinite-scroll-distance":"200","infinite-scroll-delay":10,"infinite-scroll-immediate":!1},[F("div",re,[(A(!0),N(z,null,U(w(Pe),((a,s)=>(A(),j(o,{key:s,class:"text-12px flex justify-between pl-10px py-10px cursor-pointer hover:bg-[var(--d-1A1A1A-l-F2F2F2)]",to:`/token/${a.index}`},{default:T((()=>[F("div",ue,[S(l,{row:a},null,8,["row"]),F("div",de,[F("div",ce,[F("span",me,I(a.symbol),1),a.risk_score>55||a.risk_level<0?(A(),j(i,{key:0,name:"custom:danger",class:"font-14 ml-2px color-#F72121"})):$("",!0)]),F("div",pe,[0===a.balance?(A(),N(z,{key:0},[C("$0")],64)):"--"===a.balance?(A(),N(z,{key:1},[C("--")],64)):(A(),N(z,{key:2},[C(I(("formatNumber"in e?e.formatNumber:w(P))(a.balance,2))+"("+I("$"+("formatNumber"in e?e.formatNumber:w(P))(a.balance_usd||0,2))+") ",1)],64))])])]),F("div",ve,[F("div",{class:B(("getColorClass"in e?e.getColorClass:w(W))(a.total_profit))},[0===Number(a.total_profit)?(A(),N(z,{key:0},[C("0")],64)):"--"===a.total_profit?(A(),N(z,{key:1},[C("--")],64)):(A(),N(z,{key:2},[C(I(Number(a.total_profit)>0?"$":"-$")+I(("formatNumber"in e?e.formatNumber:w(P))(Math.abs(Number(a.total_profit)),2)),1)],64))],2),F("div",{class:B(("getColorClass"in e?e.getColorClass:w(W))(a.total_profit_ratio))},[0===Number(a.total_profit_ratio)?(A(),N(z,{key:0},[C("0")],64)):"--"===a.total_profit_ratio?(A(),N(z,{key:1},[C("--")],64)):(A(),N(z,{key:2},[C(I(Number(a.total_profit_ratio)>0?"+":"-")+I(("formatNumber"in e?e.formatNumber:w(P))(Math.abs(100*Number(a.total_profit_ratio)),2))+"% ",1)],64))],2)]),F("div",fe,[w(ke).evmAddress&&"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"!==a.token?(A(),j(n,{key:0,size:"small",loading:w(Te)[a.index],class:"[--el-border:0] [&&]:[--el-button-bg-color:--d-222-l-F2F2F2] [&&]:font-normal",style:{padding:"4px"},onClick:O((e=>We(a)),["stop","prevent"])},{default:T((()=>[C(I(e.$t("closePosition")),1)])),_:2},1032,["loading","onClick"])):(A(),N("span",be,"--"))])])),_:2},1032,["to"])))),128)),0!==w(Pe).length||w(Me).loading?$("",!0):(A(),j(r,{key:0}))]),w(Me).loading&&1!==w(Me).pageNo?(A(),N("div",he,I(e.$t("loading")),1)):$("",!0)],8,oe)),[[d,Be]])])),_:1},8,["height"])])),[[c,w(Me).loading&&1===w(Me).pageNo]])}}});export{_e as default};
